{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "openpersona/manifest",
  "title": "Preset Manifest",
  "description": "Four-layer manifest for a preset persona bundle",
  "type": "object",
  "required": ["name", "layers"],
  "properties": {
    "name": { "type": "string", "pattern": "^[a-z0-9-]+$", "description": "Preset identifier (matches slug)" },
    "version": { "type": "string", "default": "0.1.0", "description": "Semantic version" },
    "author": { "type": "string" },
    "layers": {
      "type": "object",
      "required": ["soul", "faculties"],
      "properties": {
        "soul": {
          "oneOf": [
            { "type": "string", "description": "Relative path to persona.json" },
            {
              "type": "object",
              "required": ["ref"],
              "properties": {
                "ref": { "type": "string", "description": "Relative path to persona.json" },
                "install": { "type": "string", "pattern": "^(clawhub|skillssh):.+$", "description": "Install source for external soul template/personality pack" }
              }
            }
          ],
          "description": "Soul layer. String for local persona.json path, object form for external soul templates."
        },
        "body": {
          "oneOf": [
            { "type": "string", "description": "Embodiment name or path" },
            { "type": "null" },
            {
              "type": "object",
              "required": ["name"],
              "properties": {
                "name": { "type": "string", "description": "Embodiment identifier" },
                "install": { "type": "string", "pattern": "^(clawhub|skillssh):.+$", "description": "Install source for external embodiment" }
              }
            }
          ],
          "description": "Body layer reference. null for pure digital agents, string for local, object with install for external."
        },
        "faculties": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["name"],
            "properties": {
              "name": { "type": "string", "description": "Faculty identifier" },
              "install": { "type": "string", "pattern": "^(clawhub|skillssh):.+$", "description": "Install source for external faculty" }
            }
          },
          "description": "Faculties the persona uses. Each can reference a local definition in layers/faculties/ or an external package via install."
        },
        "skills": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["name"],
            "properties": {
              "name": { "type": "string", "description": "Skill identifier" },
              "description": { "type": "string", "description": "What this skill does" },
              "trigger": { "type": "string", "description": "When the agent should use this skill" },
              "install": { "type": "string", "pattern": "^(clawhub|skillssh):.+$", "description": "Install source — e.g. clawhub:pkg-name or skillssh:pkg-name. Omit if already available in environment." }
            }
          },
          "description": "Skills the persona can use. Each skill is a capability declaration; optional install field triggers auto-installation."
        }
      }
    },
    "allowedTools": {
      "type": "array",
      "items": { "type": "string" },
      "description": "Base tool permissions (faculties append additional permissions)"
    },
    "heartbeat": {
      "type": "object",
      "description": "Proactive check-in config — synced to openclaw.json on install/switch",
      "properties": {
        "enabled": { "type": "boolean", "default": false, "description": "Turn heartbeat on/off" },
        "strategy": {
          "type": "string",
          "enum": ["smart", "scheduled", "emotional", "rational", "wellness"],
          "default": "smart",
          "description": "Heartbeat rhythm strategy"
        },
        "maxDaily": { "type": "integer", "minimum": 0, "default": 5, "description": "Max proactive messages per day" },
        "quietHours": {
          "type": "array",
          "items": { "type": "integer", "minimum": 0, "maximum": 23 },
          "minItems": 2,
          "maxItems": 2,
          "description": "[start, end] silent hours in 24h format"
        },
        "sources": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Data sources for proactive messages (e.g. workspace-digest, context-aware, health-checkin)"
        }
      }
    },
    "meta": {
      "type": "object",
      "properties": {
        "framework": { "type": "string" },
        "frameworkVersion": { "type": "string" }
      }
    }
  }
}
